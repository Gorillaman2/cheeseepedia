{{/* Fetch and parse Discourse News topics safely */}}

{{ $url := "https://forum.cheeseepedia.org/c/news/5/l/latest.json?order=created" }}
{{ $data := dict }}

{{ with resources.GetRemote $url }}
  {{ $data = . | transform.Unmarshal }}
{{ else }}
  {{ warnf "Could not fetch Discourse JSON from %s" $url }}
{{ end }}

{{ with $data.topic_list.topics }}
<div class="recent-news">
  {{ range first 3 . }}
    {{ $topic := . }}
    {{ $topicURL := printf "https://forum.cheeseepedia.org/t/%s/%d" $topic.slug $topic.id }}
    <article class="news-item">
      <div class="news-image">
        {{ with $topic.image_url }}
          <img src="https://forum.cheeseepedia.org{{ . }}" alt="{{ $topic.title }}">
        {{ else }}
          <img src="{{ "images/news-fallback.jpg" | relURL }}" alt="{{ $topic.title }}">
        {{ end }}
      </div>
      <div class="news-content">
        <h3><a href="{{ $topicURL }}">{{ $topic.title }}</a></h3>
        <p class="news-date">{{ (time $topic.created_at).Format "Jan 2, 2006" }}</p>
      </div>
    </article>
  {{ end }}
</div>
{{ else }}
  <p>No recent news found.</p>
{{ end }}
