<!-- layouts/partials/discourse-latest.html -->
{{ $url := "https://forum.cheeseepedia.org/c/news/5/l/latest.json?order=created" }}
{{ $data := dict }}

{{ with try (resources.GetRemote $url) }}
  {{ with .Err }}
    {{ warnf "Failed to fetch Discourse JSON: %s" . }}
  {{ else with .Value }}
    {{ $data = . | transform.Unmarshal }}
  {{ else }}
    {{ warnf "Discourse resource not found (404): %q" $url }}
  {{ end }}
{{ end }}

{{ with $data.topic_list.topics }}
  {{ range first 3 . }}
    <article>
      <h2><a href="{{ .url }}">{{ .title }}</a></h2>
      {{ if .image_url }}
        <img src="{{ .image_url }}" alt="Image for {{ .title }}">
      {{ end }}
      <p>Published {{ (time .created_at).Format "Jan 2, 2006" }}</p>
    </article>
  {{ end }}
{{ end }}
